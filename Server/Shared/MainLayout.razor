@using PayrollEngine.WebApp;
@using Employee = PayrollEngine.WebApp.ViewModel.Employee
@using Tenant = PayrollEngine.WebApp.ViewModel.Tenant
@using PayrollEngine.Client.Model
@using PayrollEngine.WebApp.Presentation

@inherits MainLayoutBase

<MudThemeProvider @ref="@ThemeProvider" @bind-IsDarkMode="@IsDarkMode"
                  Theme="@AppTheme" />
<MudDialogProvider MaxWidth="MaxWidth.ExtraLarge"
                   CloseOnEscapeKey="true" />
<MudSnackbarProvider />

<MudLayout>
    @if (Session.UserAvailable)
    {
        <MudAppBar Elevation="1">
            <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start"
                       OnClick="SidebarToggleAsync" Title="Toggle sidebar" />
            <MudText Typo="Typo.h5" Style="min-width: 180px; width: max-content;">
                @ApplicationTitle
            </MudText>
            @if (Session.AnyUserFeature())
            {
                <MudGrid>
                    @* working tenant *@
                    @if (WorkingItems.TenantAvailable())
                    {
                        <MudItem xs="3" lg="3" Class="pl-8">
                            <MudSelect T="Tenant" Label="Tenant" Value="@Session.Tenant"
                           Disabled="@(!TenantChangeEnabled)"
                           Clearable="@WorkingItems.TenantReset()"
                           ValueChanged="WorkingTenantChangedAsync">
                                @foreach (var tenant in Session.Tenants)
                                {
                                    <MudSelectItem Value="@tenant">@tenant.Identifier</MudSelectItem>
                                }
                            </MudSelect>
                        </MudItem>
                    }
                    @* working payroll *@
                    @if (WorkingItems.PayrollAvailable())
                    {
                        <MudItem xs="3" lg="3">
                            <MudSelect T="Payroll" Label="Payroll" Value="@Session.Payroll"
                           Disabled="@(!PayrollChangeEnabled)"
                           Clearable="@WorkingItems.PayrollReset()"
                           ValueChanged="WorkingPayrollChangedAsync">
                                @foreach (var payroll in Session.Payrolls)
                                {
                                    <MudSelectItem Value="@payroll">@GetPayrollName(payroll) &#x2022; @GetPayrollDivisionName(payroll)</MudSelectItem>
                                }
                            </MudSelect>
                        </MudItem>
                    }
                    @* working employee *@
                    @if (WorkingItems.EmployeeAvailable())
                    {
                        <MudItem xs="3" lg="3">
                            <MudSelect T="Employee" Label="Employee" Value="@Session.Employee"
                           Disabled="@(!EmployeeChangeEnabled)"
                           Clearable="@WorkingItems.EmployeeReset()"
                           ValueChanged="WorkingEmployeeChangedAsync">
                                @foreach (var employee in Session.Employees)
                                {
                                    <MudSelectItem Value="@employee">@employee.FirstName @employee.LastName &#x2022; @employee.Identifier</MudSelectItem>
                                }
                            </MudSelect>
                        </MudItem>
                    }
                </MudGrid>
            }
            <MudSpacer />
            @* working user *@
            <MudInputLabel Class="pr-4" Style="min-width: max-content">@Session.User.FirstName&nbsp;@Session.User.LastName</MudInputLabel>
            @* user menu *@
            <MudMenu Icon="@Icons.Material.Filled.MoreVert" Color="Color.Inherit"
                 AnchorOrigin="Origin.BottomRight" TransformOrigin="Origin.TopRight">
                <MudMenuItem Icon="@Icons.Material.Filled.ManageAccounts" OnClick="SetupAccountAsync">My Account</MudMenuItem>
                @if (IsDarkMode)
                {
                    <MudMenuItem Icon="@Icons.Material.Filled.LightMode" OnClick="ToggleThemeAsync">Light mode</MudMenuItem>
                }
                else
                {
                    <MudMenuItem Icon="@Icons.Material.Filled.DarkMode" OnClick="ToggleThemeAsync">Dark mode</MudMenuItem>
                }
                <MudMenuItem Icon="@Icons.Material.Filled.Info" OnClick="AboutAsync">About</MudMenuItem>
                @if (UserLoginEnabled())
                {
                    <MudMenuItem Icon="@Icons.Material.Filled.Logout" OnClick="LogoutAsync">Logout</MudMenuItem>
                }
            </MudMenu>
        </MudAppBar>
        <MudDrawer @bind-Open="SidebarOpen" ClipMode="DrawerClipMode.Always" Elevation="2">
            <NavMenu />
        </MudDrawer>
    }
    <MudMainContent>
        <MudContainer MaxWidth="MaxWidth.ExtraExtraLarge" Style="margin: 10px 0">
            @Body
        </MudContainer>
    </MudMainContent>
</MudLayout>

<Document BaseLabel="@ApplicationTitle" />
<UserNotification @ref="Notification" />
