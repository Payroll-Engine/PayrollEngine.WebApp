@implements PayrollEngine.WebApp.Presentation.IItemValidator<Tenant>

@using PayrollEngine.WebApp.ViewModel
@using PayrollEngine.WebApp.Presentation
@using PayrollEngine.WebApp.Server.Components
@using Task = System.Threading.Tasks.Task;

<MudDialog Class="item-dialog">
    <DialogContent>
        <MudForm @ref="form">
            <MudTabs Elevation="2" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-3">
                <MudTabPanel Text="Common">
                    <MudStack Class="pa-4" Spacing="1">
                        <MudTextField T="string" @bind-Value="Tenant.Identifier"
                                      MaxLength="@SystemSpecification.KeyTextLength"
                                      ReadOnly="@Tenant.IsExistingObject"
                                      Label="@(Tenant.IsNewObject ? "Identifier (immutable)" : "Identifier")"
                                      Validation="@(!string.IsNullOrWhiteSpace(Tenant.Identifier))"
                                      Required="true" RequiredError="Identifier is required" />
                        <MudSelect T=" string" @bind-Value="Tenant.Culture" Label="Culture">
                            @foreach (var cultureName in CultureNames)
                            {
                                <MudSelectItem T="string" Value="@cultureName">@cultureName</MudSelectItem>
                            }
                        </MudSelect>
                        <MudTextField T="string" @bind-Value="Tenant.Calendar"
                                      MaxLength="@SystemSpecification.KeyTextLength"
                                      Label="Calendar" />
                        <ItemBaseFields Item="Tenant" />
                    </MudStack>
                </MudTabPanel>
                <MudTabPanel Text="Attributes">
                    <AttributesGrid Item="Tenant" Class="attributes-grid pa-2" />
                </MudTabPanel>
            </MudTabs>
        </MudForm>
    </DialogContent>
    <DialogActions>
        <ItemDialogActions Item="Tenant" FormValidator="this" />
    </DialogActions>
</MudDialog>

@code {
    MudForm form;

    [CascadingParameter] MudDialogInstance MudDialog { get; set; }
    [Parameter] public Tenant Tenant { get; set; } = new();

    private List<string> CultureNames { get; set; }

    protected override async Task OnInitializedAsync()
    {
        // cultures
        CultureNames = CultureTool.GetSpecificCultureNames();
        await base.OnInitializedAsync();
    }

    public async Task<bool> ValidateAsync(Tenant tenant) =>
        await form.Revalidate();
}