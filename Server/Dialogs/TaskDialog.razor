@implements PayrollEngine.WebApp.Presentation.IItemValidator<ViewModel.Task>

@using PayrollEngine.WebApp.Presentation
@using PayrollEngine.WebApp.Server.Components
@using Task = PayrollEngine.WebApp.ViewModel.Task

<MudDialog Class="item-dialog">
    <DialogContent>
        <MudForm @ref="form">
            <MudTabs Elevation="2" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-3">
                <MudTabPanel Text="Common">
                    <MudStack Spacing="1">
                        <LocalizationTextField Item="@Task" @bind-Value="Task.Name"
                                               PropertyName="@nameof(Task.Name)"
                                               MaxLength="@SystemSpecification.KeyTextLength"
                                               ReadOnly="@Task.IsExistingObject"
                                               Label="@(Task.IsNewObject ? "Name (immutable)" : "Name")"
                                               Validation="@(!string.IsNullOrWhiteSpace(Task.Name))"
                                               Required="true" RequiredError="Name is required" />
                        <MudTextField T="string" @bind-Value="Task.Instruction"
                                      Label="Instruction"
                                      Lines="4"
                                      Validation="@(!string.IsNullOrWhiteSpace(Task.Instruction))"
                                      Required="true" RequiredError="Instruction is required" />
                        <MudDatePicker @bind-Date="Task.Scheduled"
                                       Label="Schedule date"
                                       Validation="@Task.IsScheduled"
                                       Editable="true"
                                       Required="true" RequiredError="Schedule date is required" />
                        <MudDatePicker @bind-Date="Task.Completed"
                                       Label="Complete date"
                                       Editable="true" />
                        <MudTextField T="string" @bind-Value="Task.Category"
                                      Label="Category" />
                        <ItemBaseFields Item="Task" />
                    </MudStack>
                </MudTabPanel>
                <MudTabPanel Text="Attributes">
                    <AttributesGrid Item="Task" Class="attributes-grid" />
                </MudTabPanel>
            </MudTabs>
        </MudForm>
    </DialogContent>
    <DialogActions>
        <ItemDialogActions Item="Task" FormValidator="this" ItemValidator="Validator" />
    </DialogActions>
</MudDialog>

@code {
    MudForm form;

    [CascadingParameter] MudDialogInstance MudDialog { get; set; }
    [Parameter] public Task Task { get; set; } = new();
    [Parameter] public IItemValidator<Task> Validator { get; set; }

    public async Task<bool> ValidateAsync(Task task) =>
        await form.Revalidate();
}