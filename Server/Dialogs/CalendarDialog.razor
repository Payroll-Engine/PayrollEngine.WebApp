@implements PayrollEngine.WebApp.Presentation.IItemValidator<Calendar>

@using PayrollEngine.WebApp.ViewModel
@using PayrollEngine.WebApp.Presentation
@using PayrollEngine.WebApp.Server.Components

<MudDialog Class="item-dialog">
    <DialogContent>
        <MudForm @ref="form">
            <MudTabs Elevation="2" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-3">
                <MudTabPanel Text="Common">
                    <MudStack Class="pa-4" Spacing="1">
                        <LocalizationTextField @bind-Value="Calendar.Name"
                                               Item="@Calendar"
                                               PropertyName="@nameof(Calendar.Name)"
                                               MaxLength="@SystemSpecification.KeyTextLength"
                                               ReadOnly="@Calendar.IsExistingObject"
                                               Label="@(Calendar.IsNewObject ? "Name (immutable)" : "Name")"
                                               Validation="@(!string.IsNullOrWhiteSpace(Calendar.Name))"
                                               Required="true" RequiredError="Name is required" />
                        <MudSelect T="CalendarTimeUnit" @bind-Value="Calendar.CycleTimeUnit"
                                   Label="Cycle time unit"
                                   Required="true" RequiredError="Cycle time unit is required">
                            <EnumSelectItems T="CalendarTimeUnit" />
                        </MudSelect>
                        <MudSelect T="CalendarTimeUnit" @bind-Value="Calendar.PeriodTimeUnit"
                                   Label="Period time unit"
                                   Required="true" RequiredError="Period time unit is required">
                            <EnumSelectItems T="CalendarTimeUnit" />
                        </MudSelect>
                        <MudSelect T="CalendarTimeMap" @bind-Value="Calendar.TimeMap" Clearable="true"
                                   Label="Time map">
                            <EnumSelectItems T="CalendarTimeMap" />
                        </MudSelect>
                        <MudSelect T="Month?" @bind-Value="Calendar.FirstMonthOfYear" Clearable="true"
                                   Label="First month of year">
                            <NullableEnumSelectItems T="Month?" />
                        </MudSelect>
                        <MudNumericField T="decimal?" @bind-Value="Calendar.MonthDayCount"
                                         Label="Month day count" />
                        <MudSelect T="CalendarWeekRule?" @bind-Value="Calendar.YearWeekRule" Clearable="true"
                                   Label="Year week rule">
                            <NullableEnumSelectItems T="CalendarWeekRule?" />
                        </MudSelect>
                        <MudSelect T="PayrollEngine.DayOfWeek?" @bind-Value="Calendar.FirstDayOfWeek" Clearable="true"
                                   Label="First day of week">
                            <NullableEnumSelectItems T="PayrollEngine.DayOfWeek?" />
                        </MudSelect>
                        <MudSelect T="CalendarWeekMode" @bind-Value="Calendar.WeekMode" Clearable="true"
                                   Label="Week mode">
                            <EnumSelectItems T="CalendarWeekMode" />
                        </MudSelect>
                        <MudStack Row="true" Spacing="0">
                            <MudCheckBox @bind-Checked="@Calendar.WorkMonday" Label="Monday" Disabled="@(Calendar.WeekMode == CalendarWeekMode.Week)" />
                            <MudCheckBox @bind-Checked="@Calendar.WorkTuesday" Label="Tuesday" Disabled="@(Calendar.WeekMode == CalendarWeekMode.Week)" />
                            <MudCheckBox @bind-Checked="@Calendar.WorkWednesday" Label="Wednesday" Disabled="@(Calendar.WeekMode == CalendarWeekMode.Week)" />
                            <MudCheckBox @bind-Checked="@Calendar.WorkThursday" Label="Thursday" Disabled="@(Calendar.WeekMode == CalendarWeekMode.Week)" />
                            <MudCheckBox @bind-Checked="@Calendar.WorkFriday" Label="Friday" Disabled="@(Calendar.WeekMode == CalendarWeekMode.Week)" />
                            <MudCheckBox @bind-Checked="@Calendar.WorkSaturday" Label="Saturday" Disabled="@(Calendar.WeekMode == CalendarWeekMode.Week)" />
                            <MudCheckBox @bind-Checked="@Calendar.WorkSunday" Label="Sunday" Disabled="@(Calendar.WeekMode == CalendarWeekMode.Week)" />
                        </MudStack>
                        <ItemBaseFields Item="Calendar" />
                    </MudStack>
                </MudTabPanel>
                <MudTabPanel Text="Attributes">
                    <AttributesGrid Item="Calendar" Class="attributes-grid pa-2" />
                </MudTabPanel>
            </MudTabs>
        </MudForm>
    </DialogContent>
    <DialogActions>
        <ItemDialogActions Item="Calendar" FormValidator="this" />
    </DialogActions>
</MudDialog>

@code {
    MudForm form;

    [CascadingParameter] MudDialogInstance MudDialog { get; set; }
    [Parameter] public Calendar Calendar { get; set; } = new();

    public async Task<bool> ValidateAsync(Calendar division) =>
        await form.Revalidate();
}